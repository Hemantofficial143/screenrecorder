import "./chunk-HFNDKYVF.js";

// node_modules/shr-buttons/dist/shr.mjs
function _classCallCheck(e, t) {
  if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function");
}
function _defineProperties(e, t) {
  for (var n = 0; n < t.length; n++) {
    var r = t[n];
    r.enumerable = r.enumerable || false, r.configurable = true, "value" in r && (r.writable = true), Object.defineProperty(e, r.key, r);
  }
}
function _createClass(e, t, n) {
  return t && _defineProperties(e.prototype, t), n && _defineProperties(e, n), e;
}
function _defineProperty(e, t, n) {
  return t in e ? Object.defineProperty(e, t, { value: n, enumerable: true, configurable: true, writable: true }) : e[t] = n, e;
}
function _slicedToArray(e, t) {
  return _arrayWithHoles(e) || _iterableToArrayLimit(e, t) || _nonIterableRest();
}
function _arrayWithHoles(e) {
  if (Array.isArray(e)) return e;
}
function _iterableToArrayLimit(e, t) {
  var n = [], r = true, o = false, i = void 0;
  try {
    for (var s, a = e[Symbol.iterator](); !(r = (s = a.next()).done) && (n.push(s.value), !t || n.length !== t); r = true) ;
  } catch (e2) {
    o = true, i = e2;
  } finally {
    try {
      r || null == a.return || a.return();
    } finally {
      if (o) throw i;
    }
  }
  return n;
}
function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance");
}
var getConstructor = function(e) {
  return null != e ? e.constructor : null;
};
var instanceOf = function(e, t) {
  return !!(e && t && e instanceof t);
};
var isNullOrUndefined = function(e) {
  return null == e;
};
var isObject = function(e) {
  return getConstructor(e) === Object;
};
var isNumber = function(e) {
  return getConstructor(e) === Number && !Number.isNaN(e);
};
var isString = function(e) {
  return getConstructor(e) === String;
};
var isBoolean = function(e) {
  return getConstructor(e) === Boolean;
};
var isFunction = function(e) {
  return getConstructor(e) === Function;
};
var isArray = function(e) {
  return Array.isArray(e);
};
var isNodeList = function(e) {
  return instanceOf(e, NodeList);
};
var isElement = function(e) {
  return instanceOf(e, Element);
};
var isEvent = function(e) {
  return instanceOf(e, Event);
};
var isEmpty = function(e) {
  return isNullOrUndefined(e) || (isString(e) || isArray(e) || isNodeList(e)) && !e.length || isObject(e) && !Object.keys(e).length;
};
var is = { nullOrUndefined: isNullOrUndefined, object: isObject, number: isNumber, string: isString, boolean: isBoolean, function: isFunction, array: isArray, nodeList: isNodeList, element: isElement, event: isEvent, empty: isEmpty };
var constants = { facebook: { domain: "facebook.com", url: function(e) {
  return "https://graph.facebook.com/?id=".concat(e, "&fields=og_object{engagement}");
}, shareCount: function(e) {
  return e.og_object.engagement.count;
}, popup: { width: 640, height: 360 } }, twitter: { domain: "twitter.com", url: function() {
  return null;
}, shareCount: function() {
  return null;
}, popup: { width: 640, height: 240 } }, pinterest: { domain: "pinterest.com", url: function(e) {
  return "https://widgets.pinterest.com/v1/urls/count.json?url=".concat(e);
}, shareCount: function(e) {
  return e.count;
}, popup: { width: 830, height: 700 } }, github: { domain: "github.com", url: function(e, t) {
  return "https://api.github.com/repos/".concat(e).concat(is.string(t) ? "?access_token=".concat(t) : "");
}, shareCount: function(e) {
  return e.data.stargazers_count;
} }, youtube: { domain: "youtube.com", url: function(e, t) {
  return "https://www.googleapis.com/youtube/v3/channels?part=statistics&id=".concat(e, "&key=").concat(t);
}, shareCount: function(e) {
  if (!is.empty(e.error)) return null;
  var t = _slicedToArray(e.items, 1)[0];
  return is.empty(t) ? null : t.statistics.subscriberCount;
} } };
var defaults = { debug: false, wrapper: { className: "shr" }, count: { className: "shr__count", displayZero: false, format: true, position: "after", increment: true }, tokens: { github: "", youtube: "" }, storage: { enabled: true, key: "shr", ttl: 3e5 } };
function getJSONP(e) {
  return new Promise(function(t, n) {
    var r = "jsonp_callback_".concat(Math.round(1e5 * Math.random())), o = document.createElement("script");
    o.addEventListener("error", function(e2) {
      return n(e2);
    }), window[r] = function(e2) {
      delete window[r], document.body.removeChild(o), t(e2);
    };
    var i = new URL(e);
    i.searchParams.set("callback", r), o.setAttribute("src", i.toString()), document.body.appendChild(o);
  });
}
var noop = function() {
};
var Console = function() {
  function e() {
    var t = !!(0 < arguments.length && void 0 !== arguments[0]) && arguments[0];
    _classCallCheck(this, e), this.enabled = window.console && t, this.enabled && this.log("Debugging enabled");
  }
  return _createClass(e, [{ key: "log", get: function() {
    return this.enabled ? Function.prototype.bind.call(console.log, console) : noop;
  } }, { key: "warn", get: function() {
    return this.enabled ? Function.prototype.bind.call(console.warn, console) : noop;
  } }, { key: "error", get: function() {
    return this.enabled ? Function.prototype.bind.call(console.error, console) : noop;
  } }]), e;
}();
function matches(e, t) {
  return (function() {
    return Array.from(document.querySelectorAll(t)).includes(this);
  }).call(e, t);
}
function wrap(e, t) {
  var n = e.length ? e : [e];
  Array.from(n).reverse().forEach(function(e2, n2) {
    var r = 0 < n2 ? t.cloneNode(true) : t, o = e2.parentNode, i = e2.nextSibling;
    r.appendChild(e2), i ? o.insertBefore(r, i) : o.appendChild(r);
  });
}
function setAttributes(e, t) {
  !is.element(e) || is.empty(t) || Object.entries(t).filter(function(e2) {
    var t2 = _slicedToArray(e2, 2)[1];
    return !is.nullOrUndefined(t2);
  }).forEach(function(t2) {
    var n = _slicedToArray(t2, 2), r = n[0], o = n[1];
    return e.setAttribute(r, o);
  });
}
function createElement(e, t, n) {
  var r = document.createElement(e);
  return is.object(t) && setAttributes(r, t), is.string(n) && (r.innerText = n), r;
}
function formatNumber(e) {
  var t = /\./.test(1.1.toLocaleString()) ? "." : ",", n = new RegExp("\\".concat(t, "\\d+$"));
  return Math.round(e).toLocaleString().replace(n, "");
}
function extend() {
  for (var e = 0 < arguments.length && void 0 !== arguments[0] ? arguments[0] : {}, t = arguments.length, n = Array(1 < t ? t - 1 : 0), r = 1; r < t; r++) n[r - 1] = arguments[r];
  if (!n.length) return e;
  var o = n.shift();
  return is.object(o) ? (Object.keys(o).forEach(function(t2) {
    is.object(o[t2]) ? (!Object.keys(e).includes(t2) && Object.assign(e, _defineProperty({}, t2, {})), extend(e[t2], o[t2])) : Object.assign(e, _defineProperty({}, t2, o[t2]));
  }), extend.apply(void 0, [e].concat(n))) : e;
}
var Storage = function() {
  function e(t, n) {
    var r = !(2 < arguments.length && void 0 !== arguments[2]) || arguments[2];
    _classCallCheck(this, e), this.enabled = r && e.supported, this.key = t, this.ttl = n;
  }
  return _createClass(e, [{ key: "get", value: function(t) {
    if (!e.supported || !this.enabled) return null;
    var n = window.localStorage.getItem(this.key);
    if (is.empty(n)) return null;
    var r = window.localStorage.getItem("".concat(this.key, "_ttl"));
    if (is.empty(r) || r < Date.now()) return null;
    var o = JSON.parse(n);
    return is.string(t) && t.length ? o[t] : o;
  } }, { key: "set", value: function(t) {
    if (e.supported && this.enabled && is.object(t)) {
      var n = this.get();
      is.empty(n) && (n = {}), extend(n, t), window.localStorage.setItem(this.key, JSON.stringify(n)), window.localStorage.setItem("".concat(this.key, "_ttl"), Date.now() + this.ttl);
    }
  } }], [{ key: "supported", get: function() {
    try {
      return "localStorage" in window && (window.localStorage.setItem("___test", "___test"), window.localStorage.removeItem("___test"), true);
    } catch (e2) {
      return false;
    }
  } }]), e;
}();
function getDomain(e) {
  var t = new URL(e).hostname, n = t.split("."), r = n.length;
  return 2 < r && (t = "".concat(n[r - 2], ".").concat(n[r - 1]), 2 === n[r - 2].length && 2 === n[r - 1].length && (t = "".concat(n[r - 3], ".").concat(t))), t;
}
var Shr = function() {
  function e(t, n) {
    var r = this;
    _classCallCheck(this, e), this.elements = { count: null, trigger: null, popup: null }, is.element(t) ? this.elements.trigger = t : is.string(t) && (this.elements.trigger = document.querySelector(t)), is.element(this.elements.trigger) && is.empty(this.elements.trigger.shr) && (this.config = extend({}, defaults, n, { networks: constants }), this.console = new Console(this.config.debug), this.storage = new Storage(this.config.storage.key, this.config.storage.ttl, this.config.storage.enabled), this.getCount().then(function(e2) {
      return r.updateDisplay(e2);
    }).catch(function() {
    }), this.listeners(true), this.elements.trigger.shr = this);
  }
  return _createClass(e, [{ key: "destroy", value: function() {
    this.listeners(false);
  } }, { key: "listeners", value: function() {
    var e2 = this, t = !!(0 < arguments.length && void 0 !== arguments[0]) && arguments[0] ? "addEventListener" : "removeEventListener";
    this.elements.trigger[t]("click", function(t2) {
      return e2.share(t2);
    }, false);
  } }, { key: "share", value: function(e2) {
    var t = this;
    this.openPopup(e2);
    var n = this.config.count.increment;
    this.getCount().then(function(e3) {
      return t.updateDisplay(e3, n);
    }).catch(function() {
    });
  } }, { key: "openPopup", value: function(e2) {
    if (!is.empty(this.network) && this.networkConfig.popup) {
      is.event(e2) && e2.preventDefault();
      var t = this.networkConfig.popup, n = t.width, r = t.height, o = "shr-popup--".concat(this.network);
      if (this.popup && !this.popup.closed) this.popup.focus(), this.console.log("Popup re-focused.");
      else {
        var i = void 0 === window.screenLeft ? window.screen.left : window.screenLeft, s = void 0 === window.screenTop ? window.screen.top : window.screenTop, a = window.screen.width / 2 - n / 2 + i, c = window.screen.height / 2 - r / 2 + s;
        this.popup = window.open(this.href, o, "top=".concat(c, ",left=").concat(a, ",width=").concat(n, ",height=").concat(r)), !this.popup || this.popup.closed || !is.boolean(this.popup.closed) ? this.console.error("Popup blocked.") : (this.popup.focus(), this.console.log("Popup opened."));
      }
    }
  } }, { key: "getCount", value: function() {
    var e2 = this, t = !(0 < arguments.length && void 0 !== arguments[0]) || arguments[0];
    return new Promise(function(n, r) {
      var o = e2.apiUrl;
      if (is.empty(o)) r(new Error("No URL available for ".concat(e2.network, ".")));
      else {
        if (t) {
          var i = e2.storage.get(e2.target);
          if (!is.empty(i) && Object.keys(i).includes(e2.network)) {
            var s = i[e2.network];
            return n(is.number(s) ? s : 0), void e2.console.log("getCount for '".concat(e2.target, "' for '").concat(e2.network, "' resolved from cache."));
          }
        }
        getJSONP(o).then(function(t2) {
          var r2 = 0, o2 = e2.elements.trigger.getAttribute("data-shr-display");
          r2 = is.empty(o2) ? e2.networkConfig.shareCount(t2) : t2[o2], is.empty(r2) ? r2 = 0 : (r2 = parseInt(r2, 10), !is.number(r2) && (r2 = 0)), e2.storage.set(_defineProperty({}, e2.target, _defineProperty({}, e2.network, r2))), n(r2);
        }).catch(r);
      }
    });
  } }, { key: "updateDisplay", value: function(e2) {
    var t = !!(1 < arguments.length && void 0 !== arguments[1]) && arguments[1], n = this.config, r = n.count, o = n.wrapper, i = t ? e2 + 1 : e2, s = r.position.toLowerCase();
    if (0 < i || r.displayZero) {
      var a = function(e3) {
        return Math.round(i / e3 * 10) / 10;
      }, c = formatNumber(i);
      r.format && (1e6 < i ? c = "".concat(a(1e6), "M") : 1e3 < i && (c = "".concat(a(1e3), "K"))), is.element(this.elements.count) ? this.elements.count.textContent = c : (wrap(this.elements.trigger, createElement("span", { class: o.className })), this.elements.count = createElement("span", { class: "".concat(r.className, " ").concat(r.className, "--").concat(s) }, c), this.elements.trigger.insertAdjacentElement("after" === s ? "afterend" : "beforebegin", this.elements.count));
    }
  } }, { key: "href", get: function() {
    return is.element(this.elements.trigger) ? this.elements.trigger.href : null;
  } }, { key: "network", get: function() {
    var e2 = this;
    if (!is.element(this.elements.trigger)) return null;
    var t = this.config.networks;
    return Object.keys(t).find(function(n) {
      return getDomain(e2.href) === t[n].domain;
    });
  } }, { key: "networkConfig", get: function() {
    return is.empty(this.network) ? null : this.config.networks[this.network];
  } }, { key: "target", get: function() {
    if (is.empty(this.network)) return null;
    var e2 = new URL(this.href);
    switch (this.network) {
      case "facebook":
        return e2.searchParams.get("u");
      case "github":
        return e2.pathname.substring(1);
      case "youtube":
        return e2.pathname.split("/").pop();
      default:
        return e2.searchParams.get("url");
    }
  } }, { key: "apiUrl", get: function() {
    if (is.empty(this.network)) return null;
    var e2 = this.config.tokens;
    switch (this.network) {
      case "github":
        return this.networkConfig.url(this.target, e2.github);
      case "youtube":
        return this.networkConfig.url(this.target, e2.youtube);
      default:
        return this.networkConfig.url(encodeURIComponent(this.target));
    }
  } }], [{ key: "setup", value: function(t) {
    var n = 1 < arguments.length && void 0 !== arguments[1] ? arguments[1] : {}, r = null;
    if (is.string(t) ? r = Array.from(document.querySelectorAll(t)) : is.element(t) ? r = [t] : is.nodeList(t) ? r = Array.from(t) : is.array(t) && (r = t.filter(is.element)), is.empty(r)) return null;
    var o = Object.assign({}, defaults, n);
    is.string(t) && o.watch && new MutationObserver(function(n2) {
      Array.from(n2).forEach(function(n3) {
        Array.from(n3.addedNodes).forEach(function(n4) {
          is.element(n4) && matches(n4, t) && new e(n4, o);
        });
      });
    }).observe(document.body, { childList: true, subtree: true });
    return r.map(function(t2) {
      return new e(t2, n);
    });
  } }]), e;
}();
var shr_default = Shr;
export {
  shr_default as default
};
//# sourceMappingURL=shr-buttons.js.map
